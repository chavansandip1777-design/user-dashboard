<div class="app-container">
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <main class="main-content">
    <app-header (searchChange)="onHeaderSearch($event)"></app-header>

    <!-- Page Content -->
    <div class="page-content">
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h2 class="page-title">User Management</h2>
          <p class="page-breadcrumb">Hi, Welcome to User Management</p>
        </div>
        <div class="add-user-dropdown">
          <button class="add-user-btn" (click)="toggleAddUserMenu()">
            Add Users
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
          <div class="dropdown-menu" *ngIf="showAddUserMenu">
            <a class="dropdown-item" (click)="addUser('staff')">Add Staff</a>
            <a class="dropdown-item" (click)="addUser('student')">Add Student</a>
          </div>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-header purple-bg">
            <div class="stat-icon-wrapper">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </div>
            <div class="stat-header-content">
              <h3 class="stat-title">Hostel Admin Count</h3>
              <div class="stat-number">{{ getAdminCount() }}</div>
            </div>
          </div>
          <div class="stat-card-body">
            <div class="stat-details">
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Active</span>
                  <span class="stat-value active">{{ getActiveCountForRole('admin') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill active"
                    [style.width]="(getActiveCountForRole('admin') / getAdminCount() * 100) + '%'"></div>
                </div>
              </div>
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Inactive</span>
                  <span class="stat-value inactive">{{ getInactiveCountForRole('admin') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill inactive"
                    [style.width]="(getInactiveCountForRole('admin') / getAdminCount() * 100) + '%'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header blue-bg">
            <div class="stat-icon-wrapper">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </div>
            <div class="stat-header-content">
              <h3 class="stat-title">Hostel Staff Count</h3>
              <div class="stat-number">{{ getStaffCount() }}</div>
            </div>
          </div>
          <div class="stat-card-body">
            <div class="stat-details">
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Active</span>
                  <span class="stat-value active">{{ getActiveCountForRole('staff') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill active"
                    [style.width]="(getActiveCountForRole('staff') / getStaffCount() * 100) + '%'"></div>
                </div>
              </div>
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Inactive</span>
                  <span class="stat-value inactive">{{ getInactiveCountForRole('staff') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill inactive"
                    [style.width]="(getInactiveCountForRole('staff') / getStaffCount() * 100) + '%'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header green-bg">
            <div class="stat-icon-wrapper">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path
                  d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </div>
            <div class="stat-header-content">
              <h3 class="stat-title">Hostel Students Count</h3>
              <div class="stat-number">{{ getStudentCount() }}</div>
            </div>
          </div>
          <div class="stat-card-body">
            <div class="stat-details">
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Active</span>
                  <span class="stat-value active">{{ getActiveCountForRole('student') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill active"
                    [style.width]="(getActiveCountForRole('student') / getStudentCount() * 100) + '%'"></div>
                </div>
              </div>
              <div class="stat-item-wrapper">
                <div class="stat-item">
                  <span class="stat-label">Inactive</span>
                  <span class="stat-value inactive">{{ getInactiveCountForRole('student') }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill inactive"
                    [style.width]="(getInactiveCountForRole('student') / getStudentCount() * 100) + '%'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div class="content-section">
        <!-- Filter Tabs -->
        <div class="filter-tabs">
          <div class="filter-left">
            <div class="role-dropdown">
              <button class="dropdown-btn" (click)="toggleRoleDropdown()">
                {{ selectedRole === 'all' ? 'Hostel Admins' : selectedRole === 'admin' ? 'Hostel Admins' : selectedRole
                === 'staff' ? 'Hostel Staff' : 'Hostel Students' }}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                  <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>
              <div class="dropdown-menu-filter" *ngIf="showRoleDropdown">
                <a class="dropdown-item" (click)="selectRole('admin')">Hostel Admins</a>
                <a class="dropdown-item" (click)="selectRole('staff')">Hostel Staff</a>
                <a class="dropdown-item" (click)="selectRole('student')">Hostel Students</a>
              </div>
            </div>
          </div>

          <div class="status-filter-tabs">
            <button class="status-tab" [class.active]="selectedStatus === 'all'" (click)="onStatusChange('all')">
              All
            </button>
            <button class="status-tab" [class.active]="selectedStatus === 'active'" (click)="onStatusChange('active')">
              Active
            </button>
            <button class="status-tab" [class.active]="selectedStatus === 'inactive'"
              (click)="onStatusChange('inactive')">
              In-Active
            </button>
            <button class="status-tab" (click)="onStatusChange('left')">
              Left Out
            </button>
            <button class="icon-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="1" fill="currentColor" />
                <circle cx="12" cy="5" r="1" fill="currentColor" />
                <circle cx="12" cy="19" r="1" fill="currentColor" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-container">
          <div class="spinner"></div>
          <p>Loading users...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error" class="error-container">
          <svg class="error-icon" width="48" height="48" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
            <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
          <p>{{ error }}</p>
          <button class="retry-button" (click)="loadUsers()">Retry</button>
        </div>

        <!-- Users Grid -->
        <div *ngIf="!isLoading && !error" class="users-grid-section">
          <div *ngFor="let user of filteredUsers" class="user-card-figma">
            <div class="card-header">
              <span class="card-header-text">{{ user.role?.toUpperCase() || 'ADMIN' }} {{ user.id < 10 ? '0' + user.id :
                  user.id }}</span>
                  <label class="toggle-switch">
                    <input type="checkbox" [checked]="user.status === 'active'" (change)="toggleUserStatus(user)" />
                    <span class="toggle-slider"></span>
                  </label>
            </div>
            <div class="card-avatar">
              <img [src]="'https://i.pravatar.cc/100?u=' + user.id" [alt]="user.name" class="avatar-img" />
            </div>
            <div class="card-content">
              <h4 class="card-name">{{ user.name }}</h4>
              <p class="card-id">{{ user.id + 632764 }}</p>
              <p class="card-phone">{{ user.phone }}</p>
              <button class="card-btn" (click)="viewProfile(user.id)">View Profile</button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && !error && filteredUsers.length === 0" class="empty-state">
          <svg class="empty-icon" width="64" height="64" viewBox="0 0 24 24" fill="none">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor"
              stroke-width="2" />
          </svg>
          <h3>No users found</h3>
          <p>Try adjusting your search or filter criteria</p>
        </div>
      </div>
    </div>

    <app-footer></app-footer>
  </main>
</div>